<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Lucky Challenge - ‡∏ô‡∏£‡∏≤‡∏ß‡∏¥‡∏ó‡∏ç‡πå</title>
    <style>
        :root {
            --chalkboard-green: #1e392a;
            --grid-line: rgba(255, 255, 255, 0.05);
            --accent-yellow: #ffeb3b;
            --white: #ffffff;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--chalkboard-green);
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏î‡∏≥ */
            background-image: 
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--white);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        /* ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏•‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏â‡∏≤‡∏Å */
        .math-symbol {
            position: absolute;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.03);
            z-index: 0;
            user-select: none;
            animation: float 10s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        .screen {
            background: rgba(0, 0, 0, 0.5);
            padding: 30px;
            border-radius: 15px;
            border: 5px solid #5d4037; /* ‡∏Ç‡∏≠‡∏ö‡πÑ‡∏°‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô */
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            text-align: center;
            width: 90%;
            max-width: 550px;
            display: none;
            position: relative;
            z-index: 10;
        }

        .active { display: block; }

        h1 { font-size: 2.5em; color: var(--accent-yellow); text-shadow: 2px 2px #000; margin-top: 0; }
        
        input, select {
            padding: 12px;
            font-size: 1.1em;
            border-radius: 8px;
            border: 2px solid #5d4037;
            width: 80%;
            margin-bottom: 15px;
            text-align: center;
        }

        button {
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px #2e7d32;
            margin: 10px 5px;
        }

        button:active { transform: translateY(4px); box-shadow: 0 0 #2e7d32; }

        .stats-bar { display: flex; justify-content: space-between; margin-bottom: 15px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; }
        
        .lucky-box {
            font-size: 3.5em;
            background: #fdfdfd;
            color: #333;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            min-height: 110px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 5px solid var(--accent-yellow);
        }

        .timer { color: #ff5252; font-weight: bold; }
        #feedback { font-size: 1.4em; height: 1.5em; margin: 10px 0; }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î */
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            color: #333;
            border-radius: 8px;
            overflow: hidden;
        }
        .summary-table th, .summary-table td { padding: 10px; border: 1px solid #ddd; }
        .summary-table th { background: #5d4037; color: white; }

        .creator-info { font-size: 0.9em; margin-top: 30px; color: #ccc; }
    </style>
</head>
<body>

    <div class="math-symbol" style="top:10%; left:5%;">+</div>
    <div class="math-symbol" style="top:20%; right:10%;">√∑</div>
    <div class="math-symbol" style="bottom:15%; left:15%;">œÄ</div>
    <div class="math-symbol" style="bottom:10%; right:5%;">‚àë</div>

    <div id="start-screen" class="screen active">
        <h1>üî¢ Math Lucky Game</h1>
        <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡πá‡∏ß</p>
        <input type="text" id="player-name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." maxlength="15">
        <select id="difficulty">
            <option value="easy">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏á‡πà‡∏≤‡∏¢ (‡πÄ‡∏•‡∏Ç 1-10)</option>
            <option value="medium" selected>‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡πÄ‡∏•‡∏Ç 1-20)</option>
            <option value="hard">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏¢‡∏≤‡∏Å (‡πÄ‡∏•‡∏Ç 1-50)</option>
        </select>
        <br>
        <button onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
        <div class="creator-info">
            ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥: <b>‡∏î.‡∏ä.‡∏ô‡∏£‡∏≤‡∏ß‡∏¥‡∏ó‡∏ç‡πå ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏∏‡∏Å</b> ‡∏°.2/2 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 6
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="stats-bar">
            <div>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà: <span id="round-count">1</span>/5</div>
            <div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
        </div>
        <div class="timer">‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="time-left">30</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
        
        <div id="lucky-display" class="lucky-box">READY?</div>
        
        <div id="question-area" style="display: none;">
            <input type="number" id="answer-input" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
            <br>
            <button onclick="checkAnswer()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
        </div>
        
        <button id="lucky-btn" onclick="rollLucky()">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå üé≤</button>
        <div id="feedback"></div>
    </div>

    <div id="summary-screen" class="screen">
        <h1>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h1>
        <div style="font-size: 1.2em;">‡∏Ñ‡∏∏‡∏ì <span id="final-name"></span></div>
        <div style="font-size: 4em; color: var(--accent-yellow); margin: 10px 0;" id="final-score">0</div>
        <div id="final-message" style="margin-bottom: 20px;"></div>
        
        <div id="wrong-container" style="display: none;">
            <p style="text-align: left; margin-bottom: 5px;">üìã ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô:</p>
            <table class="summary-table">
                <thead><tr><th>‡πÇ‡∏à‡∏ó‡∏¢‡πå</th><th>‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö</th><th>‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å</th></tr></thead>
                <tbody id="wrong-body"></tbody>
            </table>
        </div>

        <button onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>

    <script>
        let score = 0, timeLeft = 30, timerId, correctAnswer, currentQ = "", round = 1;
        let mistakes = [], isRolling = false;

        // ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, type, dur) {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }

        function startGame() {
            if (!document.getElementById('player-name').value) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
            if (audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
        }

        function rollLucky() {
            if (isRolling) return;
            isRolling = true;
            document.getElementById('lucky-btn').style.display = 'none';
            document.getElementById('feedback').innerText = "";
            let count = 0;
            const interval = setInterval(() => {
                document.getElementById('lucky-display').innerText = Math.floor(Math.random() * 99);
                playSfx(200 + (count * 20), 'sine', 0.1);
                if (++count > 12) { clearInterval(interval); generateQ(); }
            }, 80);
        }

        function generateQ() {
            const diff = document.getElementById('difficulty').value;
            let max = diff === 'easy' ? 10 : (diff === 'medium' ? 20 : 50);
            let ops = ['+', '-'];
            if (diff !== 'easy') ops.push('*');

            const n1 = Math.floor(Math.random() * max) + 1;
            const n2 = Math.floor(Math.random() * max) + 1;
            const op = ops[Math.floor(Math.random() * ops.length)];
            
            currentQ = `${n1} ${op} ${n2}`;
            correctAnswer = eval(currentQ);
            
            document.getElementById('lucky-display').innerText = currentQ;
            document.getElementById('question-area').style.display = 'block';
            document.getElementById('answer-input').value = "";
            document.getElementById('answer-input').focus();
            isRolling = false;
            startTimer();
        }

        function startTimer() {
            clearInterval(timerId); timeLeft = 30;
            document.getElementById('time-left').innerText = timeLeft;
            timerId = setInterval(() => {
                if (--timeLeft <= 0) { clearInterval(timerId); checkAnswer(true); }
                document.getElementById('time-left').innerText = timeLeft;
            }, 1000);
        }

        function checkAnswer(timeout = false) {
            clearInterval(timerId);
            const ans = parseInt(document.getElementById('answer-input').value);
            const fb = document.getElementById('feedback');
            
            if (!timeout && ans === correctAnswer) {
                score += 10; fb.innerText = "‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! +10"; fb.style.color = "#4caf50";
                playSfx(600, 'sine', 0.2);
            } else {
                score -= 5;
                fb.innerText = `‚ùå ‡∏ú‡∏¥‡∏î! (‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏∑‡∏≠ ${correctAnswer})`; fb.style.color = "#ff5252";
                playSfx(150, 'sawtooth', 0.3);
                mistakes.push({ q: currentQ, mine: timeout ? "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤" : ans, real: correctAnswer });
            }
            
            document.getElementById('score').innerText = score;
            document.getElementById('question-area').style.display = 'none';
            setTimeout(() => {
                if (round < 5) {
                    round++; document.getElementById('round-count').innerText = round;
                    document.getElementById('lucky-btn').style.display = 'inline-block';
                } else { showSummary(); }
            }, 1500);
        }

        function showSummary() {
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('summary-screen').classList.add('active');
            document.getElementById('final-name').innerText = document.getElementById('player-name').value;
            document.getElementById('final-score').innerText = score;
            
            const msg = document.getElementById('final-message');
            if (score >= 40) msg.innerText = "üåü ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢! ‡πÄ‡∏Å‡πà‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏°‡∏≤‡∏Å‡πÜ";
            else if (score >= 0) msg.innerText = "üëç ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞!";
            else msg.innerText = "üí™ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡πâ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞! ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡∏Ñ‡∏£‡∏±‡∏ö";

            if (mistakes.length > 0) {
                document.getElementById('wrong-container').style.display = 'block';
                const body = document.getElementById('wrong-body');
                body.innerHTML = mistakes.map(m => `<tr><td>${m.q}</td><td>${m.mine}</td><td>${m.real}</td></tr>`).join('');
            }
        }

        document.getElementById("answer-input").addEventListener("keyup", e => { if(e.key==="Enter") checkAnswer(); });
    </script>
</body>
</html>